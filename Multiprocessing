import time
from joblib import Parallel, delayed
import multiprocessing

posts=rec_model.df_in['PostId'].unique()
users=rec_model.df_in['UserId'].unique()
final_df=pd.DataFrame(index=users)
model=rec_model.get_model()

i=0

def estimate(pid):
    rec_posts_uid=[]
    post=np.full(shape=len(users),fill_value=pid)
    est=model.predict([users,post])
    final_df[pid]=est
    return pid


num_cores = multiprocessing.cpu_count()
start=time.time()
result=Parallel(n_jobs=num_cores)(delayed(estimate)(p) for p in posts)
print(result)
end=time.time()
print('time taken:'+str(end-start))
